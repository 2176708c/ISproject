<!DOCTYPE html>
<html>
  <head>
  <meta charset="UTF-8">
    <style>
      #map {
        height: 400px;
        width: 100%;
       }
    </style>
  </head>
  <body>
  <h3 id="demo"></h3>
    <h3>My Google Maps Demo</h3>
    <div id="map"></div>
    <script>
      function initMap() {
        drawLine(map);
      }
      function drawLine(map){
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
          if (this.readyState == 4 && this.status == 200){
            myFunction(this);
          }
        };

        xhttp.open("GET", "cycling.gpx", true);
        xhttp.send();

        function myFunction(xml) {
          var xmlDoc = xml.responseXML.getElementsByTagName("gpx")[0];
          var trk1=xmlDoc.getElementsByTagName("trk")[0];
          var trkpoints=trk1.getElementsByTagName("trkpt");
          var flightPlanCoordinates=[];
          for(i=0; i<trkpoints.length; i++){
            var lati = trkpoints[i].getAttribute("lat");
              var long = trkpoints[i].getAttribute("lon");
            var coords = new google.maps.LatLng(lati, long);
            flightPlanCoordinates.push(coords);
          }
          var flightPath = new google.maps.Polyline({
            path: flightPlanCoordinates,
            geodesic: true,
            strokeColor: '#FF0000',
            strokeOpacity: 1.0,
            strokeWeight: 2
          });
          var centre = flightPlanCoordinates[0];
              var map = new google.maps.Map(document.getElementById('map'), {
                  zoom: 10,
                  center: centre
              });
              var marker = new google.maps.Marker({
                  position: centre,
                  map: map
              });
          flightPath.setMap(map);

          var distance=0;
          var previous=flightPlanCoordinates[0];
          for(i=1; i<flightPlanCoordinates.length;i++){
            var next=flightPlanCoordinates[i];
            distance+=google.maps.geometry.spherical.computeDistanceBetween(previous,next);
            previous=next;
          }
          document.getElementById("demo").innerHTML=distance;

          

        }
      }
    </script>
    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAnKbdNHt9mOIkSxF2s71R8Cm5ZwFttV1Q&callback=initMap&libraries=geometry"/>
    </script>
  
  </body>
</html>
