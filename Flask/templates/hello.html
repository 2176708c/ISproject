<!DOCTYPE html>
<html>
  <head>
    <style>
      #map {
        height: 400px;
        width: 100%;
       }
    </style>
      <meta charset="utf-8">
      <title>Runify</title>
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/main.css') }}">
      <link rel="icon" href="static/images/running.png" type="image/gif" sizes="256x256">
  </head>


  <header>
      <nav class="navbar navbar-default">
              <div class="container-fluid">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                  </button>
                  <a class="navbar-brand" href="/">
                      <img style="max-height:30px; margin-top:-5px " src="{{ url_for('static', filename='images/running.png') }}">
                  </a>
                </div>

                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                  <ul class="nav navbar-nav">
                    <li><a href="/"><b>Home</b></a></li>
                  </ul>
                  <form class="navbar-form navbar-left">
                  </form>
                  <ul class="nav navbar-nav navbar-right">
                    <li class="dropdown">
                      <a href="#" class="dropdown-toggle" data-toggle="dropdown"><b>Login</b> <span class="caret"></span></a>
                        <ul id="login-dp" class="dropdown-menu">
                            <li>
                                 <div class="row">
                                        <div class="col-md-12">
                                            Login via
                                            <div class="social-buttons">
                                                <a href="#" class="btn btn-fb"><i class="fa fa-facebook"></i> Facebook</a>
                                                <a href="#" class="btn btn-tw"><i class="fa fa-twitter"></i> Twitter</a>
                                            </div>
                                            or
                                             <form class="form" role="form" method="post" action="login" accept-charset="UTF-8" id="login-nav">
                                                    <div class="form-group">
                                                         <label class="sr-only" for="InputEmail">Email address</label>
                                                         <input type="email" class="form-control" id="InputEmail" placeholder="Email address" required>
                                                    </div>
                                                    <div class="form-group">
                                                         <label class="sr-only" for="InputPassword">Password</label>
                                                         <input type="password" class="form-control" id="InputPassword" placeholder="Password" required>
                                                         <div class="help-block text-right"><a href="">Forget the password ?</a></div>
                                                    </div>
                                                    <div class="form-group">
                                                         <button type="submit" class="btn btn-primary btn-block">Sign in</button>
                                                    </div>
                                                    <div class="checkbox">
                                                         <label>
                                                         <input type="checkbox"> keep me logged-in
                                                         </label>
                                                    </div>
                                             </form>
                                        </div>
                                 </div>
                            </li>
                  </ul>
                </div><!-- /.navbar-collapse -->
              </div><!-- /.container-fluid -->
            </nav>


  </header>
  <body>
  <h3 id="demo"></h3>
    <h3>My Google Maps Demo</h3>
    <div id="map"></div>
    <script>
      function initMap() {
        drawLine(map);
      }
      function drawLine(map){
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
          if (this.readyState == 4 && this.status == 200){
            myFunction(this);
          }
        };

        xhttp.open("GET", "cycling.gpx", true);
        xhttp.send();

        function myFunction(xml) {
          var xmlDoc = xml.responseXML.getElementsByTagName("gpx")[0];
          var trk1=xmlDoc.getElementsByTagName("trk")[0];
          var trkpoints=trk1.getElementsByTagName("trkpt");
          var flightPlanCoordinates=[];
          for(i=0; i<trkpoints.length; i++){
            var lati = trkpoints[i].getAttribute("lat");
              var long = trkpoints[i].getAttribute("lon");
            var coords = new google.maps.LatLng(lati, long);
            flightPlanCoordinates.push(coords);
          }
          var flightPath = new google.maps.Polyline({
            path: flightPlanCoordinates,
            geodesic: true,
            strokeColor: '#FF0000',
            strokeOpacity: 1.0,
            strokeWeight: 2
          });
          var centre = flightPlanCoordinates[0];
              var map = new google.maps.Map(document.getElementById('map'), {
                  zoom: 10,
                  center: centre
              });
              var marker = new google.maps.Marker({
                  position: centre,
                  map: map
              });
          flightPath.setMap(map);

          var distance=0;
          var previous=flightPlanCoordinates[0];
          for(i=1; i<flightPlanCoordinates.length;i++){
            var next=flightPlanCoordinates[i];
            distance+=google.maps.geometry.spherical.computeDistanceBetween(previous,next);
            previous=next;
          }
          document.getElementById("demo").innerHTML=distance;

          var time1=trkpoints[trkpoints.length-1].getElementsByTagName("time")[0].innerHTML;
          var h1=parseInt(time1.slice(11,13));
          var min1=parseInt(time1.slice(14,16));
          var sec1=parseInt(time1.slice(17,19));

          var time2=trkpoints[0].getElementsByTagName("time")[0].innerHTML;
          var h2=parseInt(time2.slice(11,13));
          var min2=parseInt(time2.slice(14,16));
          var sec2=parseInt(time2.slice(17,19));

          var hoursrun=(h1-h2)%24;
          var minrun=(min1-min2);
          var secrun=(sec1-sec2);

          if (secrun < 0) {
            secrun += 60;
            minrun -= 1;
          }

          if (minrun < 0) {
            minrun += 60;
            hoursrun -= 1;
          }

          if (hoursrun < 0) {
            hoursrun += 24;
          }

          console.log(hoursrun);
          console.log(minrun);
          console.log(secrun);


        }
      }
    </script>
    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAnKbdNHt9mOIkSxF2s71R8Cm5ZwFttV1Q&callback=initMap&libraries=geometry"/>
    </script>

  </body>
</html>
